services:
  abiotic-frontend:
    container_name: abiotic-frontend
    image: ghcr.io/r9r-dev/abiotic-crafting-notes-frontend:latest
    restart: unless-stopped
    depends_on:
      - abiotic-backend
      - rendertron
    volumes:
      - ./icons:/app/data/icons:ro
      - ./data/GUI:/app/data/GUI:ro
    networks:
      - cadence
    logging:
      driver: gelf
      options:
        gelf-address: udp://localhost:12201
        tag: abiotic-frontend

  rendertron:
    container_name: rendertron
    image: ghcr.io/nickvdyck/rendertron:3.1.0
    restart: unless-stopped
    environment:
      - RENDERTRON_CACHE_MAX_ENTRIES=100
      - RENDERTRON_TIMEOUT=10000
    networks:
      - cadence
    logging:
      driver: gelf
      options:
        gelf-address: udp://localhost:12201
        tag: rendertron

  abiotic-backend:
    container_name: abiotic-backend
    image: ghcr.io/r9r-dev/abiotic-crafting-notes-backend:latest
    environment:
      - TZ=Europe/Paris
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_HOST=sql
      - POSTGRES_PORT=5432
      - POSTGRES_DB=abiotic
      - DEV_MODE=false
      - RECIPES_DATA_PATH=/app/data/recipes.json
    restart: unless-stopped
    volumes:
      - ./data:/app/data:ro
    networks:
      - cadence
    logging:
      driver: gelf
      options:
        gelf-address: udp://localhost:12201
        tag: abiotic-backend
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  cadence:
    external: true
